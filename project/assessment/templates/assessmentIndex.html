<!DOCTYPE html>
<html>
<head>
	<title>

	</title>

<link href="../static/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto" rel="stylesheet">

<style>

.dropbtn {
    background-color: #ffffff;
    color: #FFAF2D;
    padding: 10px;
    border: none;
    cursor: pointer;
}

.dropdown {
    position: absolute;
		visibility: hidden;
		opacity: 0;
		transition:all 0.8s;
    right: 10px;
		top: 10px;
}

.dropdown-content {
    display: none;
    position: absolute;
    background-color: #ffffff;
    min-width: 50px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
}

.dropdown-content a {
    color: black;
    padding: 6px 10px;
    text-decoration: none;
    display: block;
}

.dropdown-content a:hover {background-color: #FFCD7A }

.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown:hover .dropbtn {
    background-color: #ffffff;
}

.top_buttons {
	text-align: right;
	margin: 20px 0 20px 0;
}

.page_content {
    width: 90%;
    margin: 0 auto;
}

.question_container {
    margin: 15px 0;
    border: 1px solid #efeef3;
    padding: 20px 20px 40px 20px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
		position:relative;
    width: 100%;
    height: 100%;
}

span.question_id {
	font-size: 20px;
}

span.question_title {
	 margin-left: 0.2%;
    font-family: 'Roboto', sans-serif;
		font-size: 20px;
}

p.question_options {
	 margin-left: 4%;
	 margin-top: 15px;
   font-family: 'Open Sans', sans-serif;

}

.btn-default.active.focus, .btn-default.active:focus, .btn-default.active:hover, .btn-default:active.focus, .btn-default:active:focus, .btn-default:active:hover, .open>.dropdown-toggle.btn-default.focus, .open>.dropdown-toggle.btn-default:focus, .open>.dropdown-toggle.btn-default:hover
{
	outline: none;
	border-color: #FFAF2D;
	background-color: #ffffff;
}
span.question_id {
    margin-right: 10px;
}

span.question_id:after {content: '.';}

.bottom_buttons {
    visibility: hidden;
		opacity: 0;
		transition:all 0.8s;
		position: absolute;

}

.bottom_buttons select {
	margin: 0 50px;
}

.bottom_buttons.visible, .dropdown.visible {
	visibility: visible;
	opacity: 1;
}

.btn-default:hover,.btn-default:focus {
background-color: #ffffff;
border-color: #FFAF2D;
outline: none;
}

.dropdown-menu>li>a:hover {
	outline: none;
	background-color: #FFCD7A  ;
}

.dropdown-menu>li>a:focus {
	outline: none;
	background-color: #ffffff;
}

.dropdown-toggle.btn-default:focus,.dropdown-toggle.btn-default:active {
	background-color: #ffffff;
	outline: none;
	border-color: #FFAF2D;
}

.open>.dropdown-toggle.btn-default:hover,.open>.dropdown-toggle.btn-default,.open>.dropdown-toggle.btn-default:active {
	background-color:  #ffffff;
	outline: none;
}

.question_container:hover {
	border: 3px solid #FFAF2D;
}

.question_title.editable:focus {
	border: 1px solid #FFAF2D;
	outline: none;

}

.question_options.editable:focus {
	border: 1px solid #FFAF2D;
	outline: none;
	padding: 20px;
}

.bootstrap-select.btn-group:not(.input-group-btn) {
	margin-left: 1.8em;
}

</style>
</head>
<body>


<div class="container">
	 <div class="top_buttons">
		<button data-toggle="modal" data-target="#modalUpload" class="btn btn-default upload">Upload New File</button>
		<button class="btn btn-default" onclick="window.location='/logout';" type="submit">Log Out</button>
	</div>


		 <div id="modalUpload" class="modal fade" tabindex = "-1" role="dialog">
		  	<div class="modal-dialog" role="document">
			 	<div class="modal-content" >
			      <div class="modal-header">
			        <h4 class="modal-title">Upload a CSV file</h4>
			        <h4>{{message}}</h4>
			      </div>
			      	<div class="modal-body">

						<form action = "http://localhost:5000/upload" method = "POST"
									enctype = "multipart/form-data" class="right">
								<div class="form-group">
								   <input id="fileUpload" type = "file" name = "file"/>
							    </div>

								<div class="form-group">
								   <button class="btn btn-default"> Submit </button>
							   	</div>

						</form>
					      <div class="modal-footer">
					        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					      </div>
			    	</div>
		  		</div>
		  	</div>
		  </div>


		<div class="page_content">
     {% for question in questions: %}
			<div class="question_container">

				  <div class="question_header">
				   <span class="question_id">{{ question[0]}}</span>
					 <span class="question_title" contenteditable="false">{{ question[2] }}</span>

						{% for option in question[3].split(','): %}
								<p class="question_options" contenteditable="false" showData="{{option.strip('[]')}}">{{option.strip('[]" ')}}</p>
				    {% endfor %}
					</div>

					<div class="dropdown">
					  <i class="fa fa-cog dropbtn fa-2x" aria-hidden="true"></i>
					  <div class="dropdown-content">
					    <a href="javascript:void(0)" id="save_changes" role="button"><i class="fa fa-pencil fa-1x" aria-hidden="true"></i></a>
					    <a href="javascript:void(0)" id="delete" role="button"><i class="fa fa-trash-o fa-1x" aria-hidden="true"></i></a>
					  </div>
					</div>

				  <div class="bottom_buttons">
				    <select backData="{{question[5]}}" class="level selectpicker show-tick" data-width="auto"></select>
				    <select backData="{{question[6]}}" class="quesType selectpicker show-tick" data-width="auto"></select>
				    <select backData="{{question[7]}}" class="skillType selectpicker show-tick" data-width="auto"></select>
				    <select id="tags" backData="{{question[8]}}" class="tags selectpicker show-tick" multiple data-width="auto"></select>
						<select id="correctAns" backData="{{question[4]}}" class="correctAns selectpicker show-tick" multiple data-width="auto"></select>
				  </div>


		</div>

	{% endfor %}


	</div>

</div>

<script src="https://use.fontawesome.com/c36499ffe5.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">></script>

<script>
	$(document).ready( function() {
		$(".question_container").on('mouseenter', function() {
			jQuery(this).find('.bottom_buttons').addClass('visible');
			jQuery(this).find('.dropdown').addClass('visible');
		});

		$(".question_container").on('mouseleave', function() {
		  jQuery(this).find('.bottom_buttons').removeClass('visible');
			jQuery(this).find('.dropdown').removeClass('visible');
		});
		$(".question_header p").dblclick(function(){
      $(this).prop('contenteditable', true);
			$(this).addClass('editable');
   });
	});

</script>


<script type="text/javascript">

$('#save_changes').click(function(){

		var ob={};
		var question =$(this).parent().parent().parent().children();

		$.each(question,function(index,elem){

			if(index == 0){
				 ob[getIndex(0)] = $(elem).children('span.question_id')[0].innerHTML;
				 ob[getIndex(1)] = $(elem).children('span.question_title')[0].innerHTML;
				 var li="[";
				 var options = $(elem).children('p.question_options');
				 $.each(options,function(index,elem){
                li = li + '"'+ $(elem)[0].innerHTML +'",'
				 });
				 li = li.substring(0,li.length-1)+']';
         ob['options']=li;
		}

		else if(index == 2) {
        var select = $(elem).children();
				var i = 0;
				$.each(select,function(index,elem){
          if (index == 3  ) {
						var tags=[];
 					 $('#tags :selected').each(function(){
 							 tags.push($(this).text());
 							});
 							ob[getIndex(3 + i)] = tags.toString();

 						}

					else if(index==4) {
						var answer=[];
 					 $('#correctAns :selected').each(function(){
 							 answer.push($(this).text());
 							});
 							ob[getIndex(3 + i)] = answer.toString();
 						}

          else {
						ob[getIndex(3 + i)] = $(elem).find('option:selected').attr('value');
						}
						i++;
					});
			}
		});

		$.ajax({
				url: '/ajaxReceive',
				type: 'POST',
				data: JSON.stringify(ob),
				contentType: 'application/json; charset=utf-8',
				dataType: 'json',
				async: false,

				success: function(msg) {
						console.log(msg['status']);;
				}

		});
	});

	function getIndex(index){
		dict={0:"quesId",1:"question",2:"correctAnswer",3:"level",4:"questionType",5:"skillType",6:"tags"};
		return dict[index];
	}

	$('#delete').click(function() {
		 var ob = {};
     ob[getIndex(0)] = $(this).parent().parent().prev().children('span.question_id')[0].innerHTML;
     console.log(ob);

		 $.ajax({
 				url: '/ajaxDelete',
 				type: 'POST',
 				data: JSON.stringify(ob),
 				contentType: 'application/json; charset=utf-8',
 				dataType: 'json',
 				async: false,

 				success: function(msg) {
 						console.log(msg['status']);;
 				}

 		});

  });


	window.onload = function() {

		var tags = $("select.tags");
		$.each(tags, function(index,sel) {

			var levelArr = ['Marketing','Advertising','Sales'];
			levelArr.forEach(function(elem,index) {
				$(sel).append("<option value="+(index+1)+">"+elem+"</option>");
			});
		});

		var answer = $("select.correctAns");
		$.each(answer, function(index,sel) {

			var levelArr = ['A','B','C','D'];
			levelArr.forEach(function(elem,index) {
				$(sel).append("<option value="+(index+1)+">"+elem+"</option>");
			});
		});

		var selectElem = $("select.level");
		$.each(selectElem, function(index,sel) {

			var levelArr = ['easy','medium','hard'];
			levelArr.forEach(function(elem,index) {
				$(sel).append("<option value="+(index+1)+">"+elem+"</option>");
			});
		});

		var selectElem = $("select.quesType");
		$.each(selectElem, function(index,sel) {

			var typeArr = ['single Choice','multiple choice','essay','short answer'];
			typeArr.forEach(function(elem,index) {
				$(sel).append("<option value="+(index+1)+">"+elem+"</option>");
			});
		});

		var selectElem = $("select.skillType");
		$.each(selectElem, function(index,sel) {

			var skillArr = ['logical','gk','reasoning','theory','numerical'];
			skillArr.forEach(function(elem,index) {
				$(sel).append("<option value="+(index+1)+">"+elem+"</option>");
			});
		});

		var tags = $('select.tags')
		$.each(tags,function(index,elem){
			var array = elem.getAttribute('backData').split(',');
			$.each(elem,function(index,ele){
				if($.inArray(ele.innerHTML,array) != -1){
					ele.setAttribute('selected',"selected");
				}
			});
		});

		var answer = $('select.correctAns')
		$.each(answer,function(index,elem){
			var array = elem.getAttribute('backData').split(',');
			$.each(elem,function(index,ele){
				if($.inArray(ele.innerHTML,array) != -1){
					ele.setAttribute('selected',"selected");
				}
			});
		});

		var selLevel=$('select.level')
		$.each(selLevel,function(index,elem){
			$.each(elem,function(index,ele){
				if(ele.getAttribute('value')==elem.getAttribute('backData')){
					ele.setAttribute('selected',"selected");
				}

			});
		});

		var selType=$('select.quesType')
		$.each(selType,function(index,elem){
			$.each(elem,function(index,ele){
				if(ele.getAttribute('value')==elem.getAttribute('backData')){
					ele.setAttribute('selected',"selected");
				}

			});
		});

		var selSkill=$('select.skillType')
		$.each(selSkill,function(index,elem){
			$.each(elem,function(index,ele){
				if(ele.getAttribute('value')==elem.getAttribute('backData')){
					ele.setAttribute('selected',"selected");
				}
			});
		});
	}

</script>



<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>


</body>
</html>
