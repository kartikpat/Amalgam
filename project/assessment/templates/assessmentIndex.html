<!DOCTYPE html>
<html>
<head>
	<title>Assessment admin panel</title>

<link href="../static/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Roboto" rel="stylesheet">

<style>

.dropbtn {
    background-color: #ffffff;
    color: #FFAF2D;
    padding: 10px;
    border: none;
    cursor: pointer;
}

.dropdown {
    position: absolute;
	visibility: hidden;
	opacity: 0;
	transition:opacity 0.1s ease-in-out;
    -webkit-transition:opacity 0.1s ease-in-out;
    -moz-transition:opacity 0.1s ease-in-out;
    -o-transition:opacity 0.1s ease-in-out;
    right: 10px;
	top: 10px;
}

.dropdown-content {
    display: none;
    position: absolute;
    right:-2px;
    top:45px;
    box-shadow:0 0px 3px rgba(0,0,0,0.1);
    background-color: #ffffff;
    min-width: 50px;
    /*border:2px solid #FFCD7A;*/
    z-index: 1;
}

.dropdown-content a {
    color: black;
    padding: 6px 10px;
    text-decoration: none;
    display: block;
    width:100px;
}

.dropdown-content a:hover {background-color: #FFCD7A }

.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown:hover .dropbtn {
    background-color: #ffffff;
}

.top_buttons {
	text-align: right;
	display: inline-block;
	float:right;
	margin: 15px 15px 0 0;
}

.search{
	padding: 0px;
	margin: 0px;
	display: block;
}

.page_content {
    width: 90%;
    margin: 0 auto;
}

.question_container {
    margin: 15px 0px 15px 0px;
    border: 3px solid #FFFFFF;
    padding: 20px 20px 60px 20px;
    box-shadow: 0 0 4px rgba(0,0,0,0.6);
	position:relative;
    width: 100%;
    height: 100%;
    transition:all 0.1s ease-in-out;
}

.question_container input.checkbox {
	visibility: hidden;
	position:absolute;
	top:5px;
	left:5px;
	margin-top:0;
	cursor:pointer;
}

.question_container input.checkbox.visible {
	visibility: visible;
}

span.question_id {
	font-size: 16px;
	position:absolute;
}

span.question_title {
	margin-left: 0;
    font-family: 'Roboto', sans-serif;
	font-size: 16px;
	padding: 0 35px;
    display: inline-block;
    margin-bottom:10px;
}

p.question_options {
	margin-left: 35px;
	margin: 0 50px;
	font-family: 'Open Sans', sans-serif;
    padding:5px 0;
	border:1px solid #FFFFFF;
}

.question_header {
    margin-bottom: 15px;
}

.btn-default.active.focus, .btn-default.active:focus, .btn-default.active:hover, .btn-default:active.focus, .btn-default:active:focus, .btn-default:active:hover, .open>.dropdown-toggle.btn-default.focus, .open>.dropdown-toggle.btn-default:focus, .open>.dropdown-toggle.btn-default:hover
{
	outline: none;
	border-color: #FFAF2D;
	background-color: #ffffff;
}
span.question_id {
    margin-right: 10px;
}

span.question_id:after {content: '.';}

.bottom_buttons {
	position: absolute;
    font-size: 0;
    left: 20px;
    right: 20px;
    margin: 0 -10px;
}

button.btn.dropdown-toggle.btn-default {
	border-radius:0;
}

.bottom_buttons .bootstrap-select {
	width:20% !important;
	padding:0 10px;
	border-radius:0;
}

.bottom_buttons select {
	margin: 0 50px;
}

.dropdown.actions {
	border:2px solid #FFFFFF;
	z-index:3;
}

.dropdown.visible {
	visibility: visible;
	opacity: 1;
}

.btn-default:hover,.btn-default:focus {
	background-color: #ffffff;
	border-color: #FFAF2D;
	outline: none;
}

.dropdown-menu>li>a:hover {
	outline: none;
	background-color: #FFCD7A  ;
}

.dropdown-menu>li>a:focus {
	outline: none;
	background-color: #ffffff;
}

.dropdown-toggle.btn-default:focus,.dropdown-toggle.btn-default:active {
	background-color: #ffffff;
	outline: none;
	border-color: #FFAF2D;
}

.open>.dropdown-toggle.btn-default:hover,.open>.dropdown-toggle.btn-default,.open>.dropdown-toggle.btn-default:active {
	background-color:  #ffffff;
	outline: none;
}

.question_container:hover {
	border: 3px solid #FFAF2D;
}

.question_title.editable:focus {
	border: 1px solid #FFAF2D;
	outline: none;

}

.question_options.editable, .question_title.editable {
	border: 1px solid #FFAF2D;
	outline: none;
}

.question_title.editable {
     padding : 0px 35px 0 0;
     margin-left:35px;
     display:inline-block;
}

.bootstrap-select.btn-group:not(.input-group-btn) {
	margin-left:0;
}

.dropdow {
    position: relative;
    display: inline-block;
}

/* Dropdown Content (Hidden by Default) */
.dropdow-content {
    display: none;
    position: absolute;
    background-color: #ffffff;
    min-width: 100%;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
}

/* Links inside the dropdown */
.dropdow-content a {
    color: black;
    padding: 6px 10px;
    text-decoration: none;
    display: block;
    text-align:left;
    width:153px;
    margin-top:5px;
}

/* Change color of dropdown links on hover */
.dropdow-content a:hover {background-color: #FFCD7A}

/* Show the dropdown menu on hover */
.dropdow:hover .dropdow-content {
    display: block;
}

/* Change the background color of the dropdown button when the dropdown content is shown */
.dropdow:hover .dropbt {
    background-color: #ffffff;
}

button.dropdown-toggle {
    outline: 0;
}

button.dropdown-toggle:focus {
    outline:0;
    border:0
}



/* The container <div> - needed to position the dropdown content */
.dropdo {
    position: relative;
    display: inline-block;
}

/* Dropdown Content (Hidden by Default) */
.dropdo-content {
    display: none;
    position: absolute;
		top:0;
		right:100%;
    background-color: #f9f9f9;
    min-width: 150px;
    box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
    z-index: 1;
}

.second-level {
	position: relative;
}

.second-level:hover .dropdo-content {
	display:block;
}

/* Links inside the dropdown */
.dropdo-content a {
    color: black;
    padding: 5px 20px;
    text-decoration: none;
    display: block;
		width:100%;
}

/* Change color of dropdown links on hover */
.dropdo-content a:hover {background-color: #f1f1f1}

/* Show the dropdown menu on hover */
.dropdo:hover .dropdo-content {
    display: block;
}

/* Change the background color of the dropdown button when the dropdown content is shown */
.dropdo:hover .dropbtn {
    background-color: #3e8e41;
}

div#AllQuestions {
	margin-top:0;
	padding-top:15px;
}

.fileHeader span{
	display: inline-block;
	width: 23%;
    padding: 5px;
    margin: 5px;
    overflow: auto;
    font-size: 20px;
}
.file-content {
    margin:5px;
    padding: 2px;
}
.file-content span {
	display: inline-block;
	width: 23%;
    padding: 5px;
    margin: 5px;
    overflow: hidden;
}

.topHeader {
    width: 1170px;
    margin: 0 auto;
}

div.fileContainer >div.file-content:nth-of-type(even){
	background:#f5f6f7;
}

.logo {
	font-family: "Comfortaa";	
	color:white;
}

.logo h2 {
	margin:10px;
}

.logo span#domain {
    text-align: right;
    display: block;
    line-height: 1;
    position: relative;
    top: -15px;
    right:10px;
}

.navbar-form.navbar-left {
	margin:15px;
	float:right !important;
}

.navbar-form.navbar-left input.form-control {
    background-image: url(http://www.iimjobs.com/resources/img/search_icon.png);
    background-color: white;
    background-repeat: no-repeat;
    background-position: 95% 45%;
    background-size: 15px;
}

.submit-trigger {
    width: 50px;
    height: 34px;
    float: right;
    position: absolute;
    right: 0;
    top: 0px;
    /*background: red;*/
}

.navbar-form.navbar-left .form-group {
    position: relative;
}

.clearfix {
	display:block;
	clear:both;
}

.container {
	margin:15px auto;
}

</style>
<link href="https://fonts.googleapis.com/css?family=Comfortaa" rel="stylesheet">
</head>
<body>
	<header style="background-color: #212121">
			<div class="topHeader">	
				<div class="logo pull-left">
					<h2>iimjobs</h2>
					<span id="domain">.com</span>
				</div>

				

				<div class="top_buttons">
					<div class="dropdow">
						<button class="btn btn-default dropbt">Actions</button>
						<div class="dropdow-content">
							<a data-toggle="modal" data-target="#modalUpload" class="upload" role="button"><i class="fa fa-upload fa-1x" aria-hidden="true"></i>&nbsp;Upload</a>
							<a href="/listQuestions" id="delete_multiple" role="button"><i class="fa fa-trash-o fa-1x" aria-hidden="true"></i>&nbsp;Multiple Delete</a>
							<div class="second-level">
								<a href="" id="mark_difficulty" role="button" class="dropdo">Mark Level</a>
							<div class="dropdo-content">
								<a href="/listQuestions" class='levelType' data=1 >Easy</a>
								<a href="/listQuestions" class='levelType' data=2 >Medium</a>
								<a href="/listQuestions" class='levelType' data=3 >Hard</a>
							</div>
						</div>
						<div class="second-level">
							<a href="" id="mark_type" role="button" class="dropdo">Mark Type</a>
							<div class="dropdo-content">
								<a href="/listQuestions" class='markQuesType' data=1 >Single Choice</a>
								<a href="/listQuestions" class='markQuesType' data=2 >Multiple Choice</a>
								<a href="/listQuestions" class='markQuesType' data=3 >Essay</a>
								<a href="/listQuestions" class='markQuesType' data=4 >Short Answer</a>
							</div>
						</div>
						<div class="second-level">
							<a href="" id="mark_skill" role="button" class="dropdo">Mark Skill Type</a>
						  <div class="dropdo-content">
						    <a href="/listQuestions" class='markSkillType' data=1 >Logical</a>
						    <a href="/listQuestions" class='markSkillType' data=2 >Gk</a>
						    <a href="/listQuestions" class='markSkillType' data=3 >Reasoning</a>
						    <a href="/listQuestions" class='markSkillType' data=4 >Theory</a>
						    <a href="/listQuestions" class='markSkillType' data=5 >Numerical</a>
						  </div>
						</div>
		  </div>
					</div>
					<button class="btn btn-default" onclick="window.location='/logout';" type="submit">Log Out</button>
				</div>

				<div class="search">
					<form action="/searchKeyword" method="POST" class="navbar-form navbar-left" role="search">
					 <div class="form-group">
					   <input type="text" class="form-control" placeholder="Search..." name="phrase">
					   <div class="submit-trigger"></div>
					 </div>
					 <!-- <button type="submit" class="btn btn-default">Submit</button> -->
					</form>
				</div>
				<div class="clearfix"></div>
			</div>	
		</header>

<div class="container">
	
		 <div id="modalUpload" class="modal fade" tabindex = "-1" role="dialog">
		  	<div class="modal-dialog" role="document">
			 	<div class="modal-content" >
			      <div class="modal-header">
			        <h4 class="modal-title">Upload a CSV file</h4>
			        <h4>{{message}}</h4>
			      </div>
			      	<div class="modal-body">

						<form action = "http://assessment.iimjobs.com/upload" method = "POST"
									enctype = "multipart/form-data" class="right">
								<div class="form-group">
								   <input id="fileUpload" type = "file" name = "file"/>
							    </div>

								<div class="form-group">
								   <button class="btn btn-default"> Submit </button>
							   	</div>

						</form>
					      <div class="modal-footer">
					        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					      </div>
			    	</div>
		  		</div>
		  	</div>
		  </div>

<ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#AllQuestions" aria-controls="home" role="tab" data-toggle="tab">AllQuestions</a></li>
    <li role="presentation"><a href="#uploadedCsv" aria-controls="profile" role="tab" data-toggle="tab">uploaded CSV</a></li>

</ul>
<div class="tab-content" style="border:1px solid #e8e8e8; border-top:0;margin-top:0;padding-top:15px;">
    <div role="tabpanel" class="tab-pane active" id="AllQuestions">
    	<div class="page_content">
          {% for question in questions: %}

			<div class="question_container">


				  <div class="question_header">
				  	<span class="multipleCheckbox">
				  		<input class="checkbox" name="ids[]" type="checkbox" value="{{ question[0] }}"/>
				  	</span>

				    <span class="question_id" dataQuesId= "{{ question[0]}}"></span>
				    <span class="question_title" contenteditable="false">{{ question[2] }}</span>

				    <div class="options">
					{% for option in question[3].split(','): %}
							<p class="question_options" contenteditable="false" showData="{{option.strip('[]')}}">{{option.strip('[]" ')}}</p>
			   	 	{% endfor %}
			   	 	</div>
				  </div>

					<div class="dropdown actions">
					  <i class="fa fa-cog dropbtn fa-2x" aria-hidden="true"></i>
					  <div class="dropdown-content">
					    <a class="save_changes" role="button"><i class="fa fa-pencil fa-1x" aria-hidden="true"></i>&nbsp;Edit</a>
					    <a href="" class="delete" role="button"><i class="fa fa-trash-o fa-1x" aria-hidden="true"></i>&nbsp;Delete</a>
					  </div>
					</div>

				  <div class="bottom_buttons">
				    <select backData="{{question[5]}}" class="level selectpicker show-tick" ></select>
				    <select backData="{{question[6]}}" class="quesType selectpicker show-tick" ></select>
				    <select backData="{{question[7]}}" class="skillType selectpicker show-tick" ></select>
				    <select id="tags-{{question[0]}}" backData="{{question[8]}}" class="tags selectpicker show-tick" multiple ></select>
						<select id="correctAns-{{question[0]}}" backData="{{question[4]}}" class="correctAns selectpicker show-tick" multiple ></select>
				  </div>

			</div>

		   {% endfor %}
		</div>
    </div>
    <div role="tabpanel" class="tab-pane" id="uploadedCsv">
    	<div class="fileContainer">
    			<div class="fileHeader">
    				<span >File Id</span>
    				<span >File Name</span>
    				<span >Uploaded Date</span>
    				<span>File Status</span>
    			</div>
    		{%if files != None:%}	
		    	{% for res in files: %}
		    		<div class="file-content">
		    			<span class="file_id">{{ res["fileId"] }}</span>
		    			<span class="file_name">{{ res["fileName"] }}</span>
		    			<span class="uploaded_date">{{ res["date"] }}</span>
		    			<span class="status">{{res["status"]}}</span>
		    		</div>
		    	{% endfor %}
		    {% endif %}	
    	</div>
    </div>
</div>                                       

		
</div>

<script src="https://use.fontawesome.com/c36499ffe5.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js">></script>

<script>
	$(document).ready( function() {
		$(".question_container").on('mouseenter', function() {
			jQuery(this).find('.dropdown').addClass('visible');
			jQuery(this).find('input.checkbox').addClass('visible');
		});

		$(".question_container").on('mouseleave', function() {
			jQuery(this).find('.dropdown').removeClass('visible');
			jQuery(this).find('input:checkbox:not(:checked)').removeClass('visible');
			
		});

		$(".question_options,.question_title").dblclick(function(){
	      $(this).prop('contenteditable', true);
				$(this).addClass('editable');
	    });

		$(".question_options,.question_title").on('mouseleave',function(){
	      $(this).prop('contenteditable', false);
		  $(this).removeClass('editable');
	   });

		jQuery(".submit-trigger").on('click', function() {
			jQuery(this).closest('form').submit();
		});
	});

</script>


<script type="text/javascript">

$('.save_changes').click(function(){

		var ob={};
		var question =$(this).parent().parent().parent().children();

		$.each(question,function(index,elem){

		if(index == 0){
				 ob[getIndex(0)] = $(elem).children('span.question_id')[0].getAttribute('dataQuesId');
				 ob[getIndex(1)] = $(elem).children('span.question_title')[0].innerHTML;
				 var li="[";
				 var options = $(elem).children('p.question_options');
				 $.each(options,function(index,elem){
	                li = li + '"'+ $(elem)[0].innerHTML +'",'
				 });
				 li = li.substring(0,li.length-1)+']';
         		ob['options']=li;
		}

		else if(index == 2) {
				
				var id=ob['quesId'];
        		var select = $(elem).children();
				var i = 0;
				$.each(select,function(index,elem){
         			if (index == 3  ) {
						var tags=[];
	 					 $('#tags-'+ id +' :selected').each(function(){
	 							 tags.push($(this).text());
	 							});
	 							ob[getIndex(3 + i)] = tags.toString();

	 				}
					else if(index==4) {
						var answer=[];
	 					 $('#correctAns-' + id + ' :selected').each(function(){
	 							 answer.push($(this).text());
	 							});
	 							ob[getIndex(2 )] = answer.toString();
	 				}
          			else {
						ob[getIndex(3 + i)] = $(elem).find('option:selected').attr('value');
						}
						i++;
					});
				}
		});
		console.log(ob)
		$.ajax({
				url: '/ajaxUpdate',
				type: 'POST',
				data: JSON.stringify(ob),
				contentType: 'application/json; charset=utf-8',
				dataType: 'json',
				async: false,

				success: function(msg) {
						console.log("success");
						window.alert('Question updated');
				}

		});

	});

	function getIndex(index){
		dict={0:"quesId",1:"question",2:"correctAnswer",3:"level",4:"questionType",5:"skillType",6:"tags"};
		return dict[index];
	}

	$('.delete').click(function() {

		 var ob = {};
     ob[getIndex(0)] = $(this).parent().parent().prev().children('span.question_id')[0].getAttribute('dataQuesId');
     // console.log(ob);

		 $.ajax({
 				url: '/ajaxDelete',
 				type: 'POST',
 				data: JSON.stringify(ob),
 				contentType: 'application/json; charset=utf-8',
 				dataType: 'json',
 				async: false,

 				success: function(msg) {
 						console.log(msg['status']);
 				}

 		});

  });

	$('#delete_multiple').click(function() {
		 var selected = [];
		 // console.log($("input[name='ids[]']:checked"));
		$("input[name='ids[]']:checked").each(function(){
             selected.push($(this).attr('value'));
		 });
         // console.log(selected)

		 $.ajax({
 				url: '/ajaxDeleteMultiple',
 				type: 'POST',
 				data: JSON.stringify({"id":selected}),
 				contentType: 'application/json; charset=utf-8',
 				dataType: 'json',
 				async: false,

 				success: function(msg) {
 						console.log(msg['status']);
 				}

 		});

  });

	$('.levelType').click(function() {
		
		var selected = [];
		$("input[name='ids[]']:checked").each(function(){
             selected.push($(this).attr('value'));
		 });
         // console.log({"level":$(this).attr('data'),"ids":selected})

         $.ajax({
 				url: '/ajaxSetLevelMultiple',
 				type: 'POST',
 				data: JSON.stringify({"level":$(this).attr('data'),"ids":selected}),
 				contentType: 'application/json; charset=utf-8',
 				dataType: 'json',
 				async: false,

 				success: function(msg) {
 						console.log(msg['status']);
 				}

 		});
	});

	$('.markQuesType').click(function() {
		
		var selected = [];
		$("input[name='ids[]']:checked").each(function(){
             selected.push($(this).attr('value'));
		 });
         // console.log({"quesType":$(this).attr('data'),"ids":selected})

         $.ajax({
 				url: '/ajaxSetQuesTypeMultiple',
 				type: 'POST',
 				data: JSON.stringify({"quesType":$(this).attr('data'),"ids":selected}),
 				contentType: 'application/json; charset=utf-8',
 				dataType: 'json',
 				async: false,

 				success: function(msg) {
 						console.log(msg['status']);
 				}

 		});
	});

	$('.markSkillType').click(function() {
		
		var selected = [];
		$("input[name='ids[]']:checked").each(function(){
             selected.push($(this).attr('value'));
		 });
         console.log({"skillType":$(this).attr('data'),"ids":selected})

         $.ajax({
 				url: '/ajaxSetSkillTypeMultiple',
 				type: 'POST',
 				data: JSON.stringify({"skillType":$(this).attr('data'),"ids":selected}),
 				contentType: 'application/json; charset=utf-8',
 				dataType: 'json',
 				async: false,

 				success: function(msg) {
 						console.log(msg['status']);
 				}

 		});
	});

	window.onload = function() {

		var numbering=$('.question_id')
		var i=1
		$.each(numbering,function(index,elem){
			elem.innerHTML=i;
			i=i+1;
			// console.log(elem.getAttribute('dataQuesId'))
		});

		var opt=$("div.options");
		var i;
		$.each(opt,function(index,elem){
			i=65;
			$.each($(elem).children(),function(index,ele){
				ele.innerHTML = String.fromCharCode(i) +'.  '+ele.innerHTML;
				i=i+1;
			});
		});

		var tags = $("select.tags");
		$.each(tags, function(index,sel) {

			var levelArr = ['Marketing','Advertising','Sales'];
			levelArr.forEach(function(elem,index) {
				$(sel).append("<option value="+(index+1)+">"+elem+"</option>");
			});
		});

		var answer = $("select.correctAns");
		$.each(answer, function(index,sel) {

			var levelArr = ['A','B','C','D'];
			levelArr.forEach(function(elem,index) {
				$(sel).append("<option value="+(index+1)+">"+elem+"</option>");
			});
		});

		var selectElem = $("select.level");
		$.each(selectElem, function(index,sel) {

			var levelArr = ['easy','medium','hard'];
			levelArr.forEach(function(elem,index) {
				$(sel).append("<option value="+(index+1)+">"+elem+"</option>");
			});
		});

		var selectElem = $("select.quesType");
		$.each(selectElem, function(index,sel) {

			var typeArr = ['single Choice','multiple choice','essay','short answer'];
			typeArr.forEach(function(elem,index) {
				$(sel).append("<option value="+(index+1)+">"+elem+"</option>");
			});
		});

		var selectElem = $("select.skillType");
		$.each(selectElem, function(index,sel) {

			var skillArr = ['logical','gk','reasoning','theory','numerical'];
			skillArr.forEach(function(elem,index) {
				$(sel).append("<option value="+(index+1)+">"+elem+"</option>");
			});
		});

		var tags = $('select.tags')
		$.each(tags,function(index,elem){
			var array = elem.getAttribute('backData').split(',');
			$.each(elem,function(index,ele){
				if($.inArray(ele.innerHTML,array) != -1){
					ele.setAttribute('selected',"selected");
				}
			});
		});

		var answer = $('select.correctAns')
		$.each(answer,function(index,elem){
			var array = elem.getAttribute('backData').split(',');
			$.each(elem,function(index,ele){
				if($.inArray(ele.innerHTML,array) != -1){
					ele.setAttribute('selected',"selected");
				}
			});
		});

		var selLevel=$('select.level')
		$.each(selLevel,function(index,elem){
			$.each(elem,function(index,ele){
				if(ele.getAttribute('value')==elem.getAttribute('backData')){
					ele.setAttribute('selected',"selected");
				}

			});
		});

		var selType=$('select.quesType')
		$.each(selType,function(index,elem){
			$.each(elem,function(index,ele){
				if(ele.getAttribute('value')==elem.getAttribute('backData')){
					ele.setAttribute('selected',"selected");
				}

			});
		});

		var selSkill=$('select.skillType')
		$.each(selSkill,function(index,elem){
			$.each(elem,function(index,ele){
				if(ele.getAttribute('value')==elem.getAttribute('backData')){
					ele.setAttribute('selected',"selected");
				}
			});
		});

		
	}



</script>



<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>


</body>
</html>
